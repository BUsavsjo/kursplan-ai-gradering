<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <title>Testa Skolverket Syllabus API</title>
</head>
<body>
  <h2>Testa Skolverket Syllabus API</h2>
  <label>
    API base:
    <input id="apiBase" value="https://api.skolverket.se/syllabus/v1" size="40">
  </label>
  <br>
  <label>
    Ämneskod:
    <input id="subjectId" value="GRGRSVE07">
  </label>
  <br>
  <button onclick="testApi()">Testa API</button>
  <pre id="result" style="background:#eee;padding:1em;"></pre>
  <script>
    async function fetchApi(url){
      try{
        const res = await fetch(url, { mode: 'cors' });
        if(!res.ok) throw new Error('HTTP '+res.status);
        return {res, viaProxy:false};
      }catch(e){
        const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(url)}`;
        const res = await fetch(proxyUrl);
        if(!res.ok) throw new Error('Proxy HTTP '+res.status);
        return {res, viaProxy:true};
      }
    }

    async function testApi() {
      const apiBase = document.getElementById('apiBase').value.trim().replace(/\/+$/, '');
      const subjectId = document.getElementById('subjectId').value.trim();
      const url = `${apiBase}/subjects/${encodeURIComponent(subjectId)}?timespan=LATEST`;
      document.getElementById('result').textContent = 'Hämtar: ' + url;
      try {
        const {res, viaProxy} = await fetchApi(url);
        const data = await res.json();
        document.getElementById('result').textContent = JSON.stringify(data, null, 2) + (viaProxy ? "\n(via proxy)" : '');
      } catch (e) {
        document.getElementById('result').textContent = 'Fel: ' + e + '\n\nSe webbläsarens konsol för mer info.';
        console.error(e);
      }
    }
  </script>
</body>
</html>
